# 数据架构

## 乐视数据架构

### 分库分表

### 订单ID

订单ID具有全局唯一性特征, 最简单的方式是利用数据库的自增Id, 没操作一次就能获取到全局的唯一自增ID, 如果在小的应用上是完全可行的, 但是如果在每秒十万级别的订单量时, 数据库自增ID很难满足上述要求, 可以借用redis计算获取唯一的订单ID

订单ID简化图

订单ID结构:

--------- | ------- | ------
时间戳     | 机器编号 | 自增序号


### 最终一致性


### 数据库高可用

所谓的数据库高可用指的是: 当数据库由于各种原因出现问题时, 能实时或者快速的恢复数据库服务并修补数据, 从整个集群的角度看, 就想没有出现任何问题一样

?> 恢复数据不一定是修复原有数据库, 也可以是切换到其它备库

数据库高可用的主要工作是数据库恢复与数据修补, 一般以完成这两项工作的时间长短来衡量高可用的好坏

?> 数据库恢复的时间越长, 不一致数据会越多, 数据修补的时间就会越长, 整体的修复时间也会变长, 这是一个恶性循环, 所以快速修复数据是数据库高可用中的重点

**经典主从同步结构:**

![经典主从结构](https://iscod.github.io/images/mysql_master_slave_1.png)

经典结构的一大弊病是, 不管主库还是从库一但出现问题, 都需要web应用系统完成数据看恢复工作, 自动化困难, 恢复过程相当缓慢


**主从高可用结构:**

![主从高可用结构](https://iscod.github.io/images/mysql_master_slave_2.png)


web应用不与Master和Slave库直接连接, 而是连接KeepLive虚拟出的IP, 并将此IP映射到主库Master上, 主库Master有一个备用Master从库, 实时同步数据. 正常服务时web在Master读写数据, 当Master宕机时, 虚拟IP自动映射到Master从库, 这样只需要几秒, 就能完成数据恢复





### 数据分级


### 粗细管道